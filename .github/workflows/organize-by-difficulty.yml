name: Organize by Difficulty
on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

permissions:
  contents: write

jobs:
  organize:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Move problems into Easy/Medium/Hard
        shell: bash
        run: |
          set -euo pipefail
          mkdir -p Easy Medium Hard

          mapfile -t DIRS < <(git ls-files -z | xargs -0 -n1 dirname | sort -u \
            | grep -Ev '^(Easy|Medium|Hard)(/|$)')

          changed=0
          for d in "${DIRS[@]}"; do
            [[ "$d" == "." || "$d" == ".github"* ]] && continue
            readme="$d/README.md"
            [[ -f "$readme" ]] || continue

            if grep -qi '<h3>Easy</h3>' "$readme"; then target="Easy"
            elif grep -qi '<h3>Medium</h3>' "$readme"; then target="Medium"
            elif grep -qi '<h3>Hard</h3>' "$readme"; then target="Hard"
            else
              continue
            fi

            [[ "$d" == "$target"* ]] && continue
            mkdir -p "$target"
            git mv "$d" "$target/" && changed=1
          done

          if [[ "$changed" -eq 1 ]]; then
            git config user.name "github-actions[bot]"
            git config user.email "41898282+github-actions[bot]@users.noreply.github.com"
            git commit -m "chore: organize problems by difficulty"

            branch="${GITHUB_REF_NAME:-main}"
            git push origin HEAD:"$branch"
          else
            echo "No reorganization needed."
          fi
